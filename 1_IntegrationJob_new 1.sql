--begin tran
--rollback
--commit
Delete FROM CIS_TaskExecutable WHERE OwnerID = 985 AND TaskID IN (SELECT TaskID FROM CIS_Task WHERE OwnerID = 985 AND JobID IN (94) )
Delete FROM CIS_Mapping_Block WHERE OwnerID = 985 AND TaskID IN (SELECT TaskID FROM CIS_Task WHERE OwnerID = 985 AND JobID IN (94) )
Delete FROM CIS_Task WHERE OwnerID = 985 AND JobID IN (94)


INSERT INTO [dbo].[CIS_Task] (OwnerID,TaskID,TaskName,PassID,JobID,ObjectID,ExecutionOrder,CurrentStatus,SourceMethodology,ActionType,TargetMethodology,FailureAction,IsExternalDB,ConnectionString,SourceStatement,NeedsResolution,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,Description,TargetStatement,ParentTask,SourceDatabaseProvider,TargetDatabaseProvider,IsExternalTarget,TargetConnectionString,ExecutionMode,ExecuteAllBlocks,QueuePath,UniqueID,LastModifiedByType,EmailId,NotifyOnFailure,EmailSubject,EmailBody,IsSourceCaseSensitive,IsTargetCaseSensitive,IsClientDateTime) VALUES(985,320,N'Call Deviation: Blacklist Checking',76,94,0,2,1,1,30,1,2,0,N'',N'MPI_BRE_BLACKLIST_CHECKING',0,1,'2024-02-06 18:22:34',5030,'2024-10-07 09:40:54',N'',N'MPI_BRE_PROCESS_LT',39,N'Microsoft.Data.SqlClient',N'Microsoft.Data.SqlClient',0,N'',3,0,N'','853b9a87-4956-4bd5-9ec7-98173ffdef89',0,N'',0,Null,N'',0,0,Null)
INSERT INTO [dbo].[CIS_Task] (OwnerID,TaskID,TaskName,PassID,JobID,ObjectID,ExecutionOrder,CurrentStatus,SourceMethodology,ActionType,TargetMethodology,FailureAction,IsExternalDB,ConnectionString,SourceStatement,NeedsResolution,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,Description,TargetStatement,ParentTask,SourceDatabaseProvider,TargetDatabaseProvider,IsExternalTarget,TargetConnectionString,ExecutionMode,ExecuteAllBlocks,QueuePath,UniqueID,LastModifiedByType,EmailId,NotifyOnFailure,EmailSubject,EmailBody,IsSourceCaseSensitive,IsTargetCaseSensitive,IsClientDateTime) VALUES(985,321,N'MPI BRE : Update Deviation for Job',1081,94,100289,6,1,1,1,1,2,0,N'',N'MPI_BRE_UPDATE_DEVIATION',0,1,'2024-02-06 18:22:34',5030,'2024-10-07 09:40:54',N'',N'',0,N'Microsoft.Data.SqlClient',N'Microsoft.Data.SqlClient',0,N'',3,0,N'','adf50d09-9da6-42fe-a3bc-d07bcfe0ec6e',0,N'',0,Null,N'',0,0,Null)
INSERT INTO [dbo].[CIS_Task] (OwnerID,TaskID,TaskName,PassID,JobID,ObjectID,ExecutionOrder,CurrentStatus,SourceMethodology,ActionType,TargetMethodology,FailureAction,IsExternalDB,ConnectionString,SourceStatement,NeedsResolution,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,Description,TargetStatement,ParentTask,SourceDatabaseProvider,TargetDatabaseProvider,IsExternalTarget,TargetConnectionString,ExecutionMode,ExecuteAllBlocks,QueuePath,UniqueID,LastModifiedByType,EmailId,NotifyOnFailure,EmailSubject,EmailBody,IsSourceCaseSensitive,IsTargetCaseSensitive,IsClientDateTime) VALUES(985,322,N'MPI BRE : Create Deviation for Job',1081,94,100289,7,1,1,2,1,2,0,N'',N'MPI_BRE_CREATE_DEVIATION',0,1,'2024-02-06 18:22:34',5030,'2024-10-07 09:40:54',N'BRE : Create Deviation for Job',N'',0,N'Microsoft.Data.SqlClient',N'Microsoft.Data.SqlClient',0,N'',3,0,N'','9752db32-13fa-400c-83ae-dafe6688e282',0,N'',0,Null,N'',0,0,Null)
INSERT INTO [dbo].[CIS_Task] (OwnerID,TaskID,TaskName,PassID,JobID,ObjectID,ExecutionOrder,CurrentStatus,SourceMethodology,ActionType,TargetMethodology,FailureAction,IsExternalDB,ConnectionString,SourceStatement,NeedsResolution,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,Description,TargetStatement,ParentTask,SourceDatabaseProvider,TargetDatabaseProvider,IsExternalTarget,TargetConnectionString,ExecutionMode,ExecuteAllBlocks,QueuePath,UniqueID,LastModifiedByType,EmailId,NotifyOnFailure,EmailSubject,EmailBody,IsSourceCaseSensitive,IsTargetCaseSensitive,IsClientDateTime) VALUES(985,323,N'MPI BRE :Update Deviation Flag Application',1081,94,0,8,1,1,4,0,2,0,N'',N'MPI_BRE_UPDATE_APPLICATION_DEV_FLAG',0,1,'2024-02-06 18:22:34',5030,'2024-10-07 09:40:54',N'',N'MPI_BRE_UPDATE_APPLICATION_DEV_FLAG',0,N'Microsoft.Data.SqlClient',N'Microsoft.Data.SqlClient',0,N'',3,0,N'','607d49f2-7cdd-400c-a73f-63176f04f3b1',0,N'',0,Null,N'',0,0,Null)
INSERT INTO [dbo].[CIS_Task] (OwnerID,TaskID,TaskName,PassID,JobID,ObjectID,ExecutionOrder,CurrentStatus,SourceMethodology,ActionType,TargetMethodology,FailureAction,IsExternalDB,ConnectionString,SourceStatement,NeedsResolution,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,Description,TargetStatement,ParentTask,SourceDatabaseProvider,TargetDatabaseProvider,IsExternalTarget,TargetConnectionString,ExecutionMode,ExecuteAllBlocks,QueuePath,UniqueID,LastModifiedByType,EmailId,NotifyOnFailure,EmailSubject,EmailBody,IsSourceCaseSensitive,IsTargetCaseSensitive,IsClientDateTime) VALUES(985,363,N'MPI - Credit Score Deviation App Check',76,94,0,0,1,1,4,0,2,0,N'',N'MPI_CHECK_CALCULATE_APP_SCORE',0,4581,'2024-05-16 06:50:47',5030,'2024-10-07 09:40:54',N'Fetches financial applications for which app score hasn''t been computed. ',N'MPI_CHECK_CALCULATE_APP_SCORE',0,N'Microsoft.Data.SqlClient',N'Microsoft.Data.SqlClient',0,N'',3,0,N'','66c4383c-e5a6-4f55-97f5-e7ed99ae41ce',0,N'',0,Null,N'',0,0,Null)
INSERT INTO [dbo].[CIS_Task] (OwnerID,TaskID,TaskName,PassID,JobID,ObjectID,ExecutionOrder,CurrentStatus,SourceMethodology,ActionType,TargetMethodology,FailureAction,IsExternalDB,ConnectionString,SourceStatement,NeedsResolution,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,Description,TargetStatement,ParentTask,SourceDatabaseProvider,TargetDatabaseProvider,IsExternalTarget,TargetConnectionString,ExecutionMode,ExecuteAllBlocks,QueuePath,UniqueID,LastModifiedByType,EmailId,NotifyOnFailure,EmailSubject,EmailBody,IsSourceCaseSensitive,IsTargetCaseSensitive,IsClientDateTime) VALUES(985,364,N'Call Deviation - Credit Score ',76,94,0,1,1,1,30,1,2,0,N'',N'MPI_CREDIT_SCORE_DAVID_CHECK',0,4581,'2024-05-16 06:50:47',5030,'2024-10-07 09:40:54',N'Calls the EDS for Credit Score David Rule',N'MPI_BRE_PROCESS_LT',45,N'Microsoft.Data.SqlClient',N'Microsoft.Data.SqlClient',0,N'',3,0,N'','43650e1b-b4a6-4c6d-9543-2a76931daee1',0,N'',0,Null,N'',0,0,Null)
INSERT INTO [dbo].[CIS_Task] (OwnerID,TaskID,TaskName,PassID,JobID,ObjectID,ExecutionOrder,CurrentStatus,SourceMethodology,ActionType,TargetMethodology,FailureAction,IsExternalDB,ConnectionString,SourceStatement,NeedsResolution,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,Description,TargetStatement,ParentTask,SourceDatabaseProvider,TargetDatabaseProvider,IsExternalTarget,TargetConnectionString,ExecutionMode,ExecuteAllBlocks,QueuePath,UniqueID,LastModifiedByType,EmailId,NotifyOnFailure,EmailSubject,EmailBody,IsSourceCaseSensitive,IsTargetCaseSensitive,IsClientDateTime) VALUES(985,367,N'MPI : UPDATE THE PDA LEVEL',1081,94,0,9,1,1,4,0,2,0,N'',N'MPI_UPDATE_PDA_LEVEL_JOB',0,4601,'2024-10-03 08:52:56',5030,'2024-10-07 09:40:54',N'This task will update the PDA level when an application is in underwriting done status and PDA level is not stamped',N'MPI_UPDATE_PDA_LEVEL_JOB',0,N'Microsoft.Data.SqlClient',N'Microsoft.Data.SqlClient',0,N'',3,0,N'','9c8ef861-4cd9-4ade-952b-0982cdf1b886',0,N'',0,Null,N'',0,0,Null)
INSERT INTO [dbo].[CIS_Task] (OwnerID,TaskID,TaskName,PassID,JobID,ObjectID,ExecutionOrder,CurrentStatus,SourceMethodology,ActionType,TargetMethodology,FailureAction,IsExternalDB,ConnectionString,SourceStatement,NeedsResolution,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,Description,TargetStatement,ParentTask,SourceDatabaseProvider,TargetDatabaseProvider,IsExternalTarget,TargetConnectionString,ExecutionMode,ExecuteAllBlocks,QueuePath,UniqueID,LastModifiedByType,EmailId,NotifyOnFailure,EmailSubject,EmailBody,IsSourceCaseSensitive,IsTargetCaseSensitive,IsClientDateTime) VALUES(985,369,N'MPI BRE : Update FA STATUS',1081,94,100286,10,1,1,1,1,1,0,N'',N'MPI_UPDATE_FA_STATUSCODE',0,5030,'2024-10-04 11:30:52',5030,'2024-10-07 09:40:54',N'MPI BRE : Update FA STATUS',N'',0,N'Microsoft.Data.SqlClient',N'Microsoft.Data.SqlClient',0,N'',3,0,N'','45c385cd-e4d7-4c61-81ed-a5de8dbaac36',0,N'',0,Null,N'',0,0,Null)
INSERT INTO [dbo].[CIS_Task] (OwnerID,TaskID,TaskName,PassID,JobID,ObjectID,ExecutionOrder,CurrentStatus,SourceMethodology,ActionType,TargetMethodology,FailureAction,IsExternalDB,ConnectionString,SourceStatement,NeedsResolution,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,Description,TargetStatement,ParentTask,SourceDatabaseProvider,TargetDatabaseProvider,IsExternalTarget,TargetConnectionString,ExecutionMode,ExecuteAllBlocks,QueuePath,UniqueID,LastModifiedByType,EmailId,NotifyOnFailure,EmailSubject,EmailBody,IsSourceCaseSensitive,IsTargetCaseSensitive,IsClientDateTime) VALUES(985,2360,N'Call EDS : NFIS Checking',76,94,0,3,1,1,30,1,2,0,N'',N'MPI_JOB_DAVID_NFIS_CHECKING',0,1,'2024-03-27 03:13:49',5030,'2024-10-07 09:40:54',N'',N'MPI_BRE_PROCESS_LT',243,N'Microsoft.Data.SqlClient',N'Microsoft.Data.SqlClient',0,N'',3,0,N'','1280fd0c-c606-4a03-8b6b-1041848676d2',0,N'',0,Null,N'',0,0,Null)
INSERT INTO [dbo].[CIS_Task] (OwnerID,TaskID,TaskName,PassID,JobID,ObjectID,ExecutionOrder,CurrentStatus,SourceMethodology,ActionType,TargetMethodology,FailureAction,IsExternalDB,ConnectionString,SourceStatement,NeedsResolution,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,Description,TargetStatement,ParentTask,SourceDatabaseProvider,TargetDatabaseProvider,IsExternalTarget,TargetConnectionString,ExecutionMode,ExecuteAllBlocks,QueuePath,UniqueID,LastModifiedByType,EmailId,NotifyOnFailure,EmailSubject,EmailBody,IsSourceCaseSensitive,IsTargetCaseSensitive,IsClientDateTime) VALUES(985,2361,N'Call EDS : CMAP Checking',76,94,0,4,1,1,30,1,2,0,N'',N'MPI_JOB_DAVID_CMAP_CHECKING',0,1,'2024-03-27 03:33:59',5030,'2024-10-07 09:40:54',N'',N'MPI_BRE_PROCESS_LT',244,N'Microsoft.Data.SqlClient',N'Microsoft.Data.SqlClient',0,N'',3,0,N'','fff3dc41-2fe1-48f4-a84d-b67fc832b958',0,N'',0,Null,N'',0,0,Null)
INSERT INTO [dbo].[CIS_Task] (OwnerID,TaskID,TaskName,PassID,JobID,ObjectID,ExecutionOrder,CurrentStatus,SourceMethodology,ActionType,TargetMethodology,FailureAction,IsExternalDB,ConnectionString,SourceStatement,NeedsResolution,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,Description,TargetStatement,ParentTask,SourceDatabaseProvider,TargetDatabaseProvider,IsExternalTarget,TargetConnectionString,ExecutionMode,ExecuteAllBlocks,QueuePath,UniqueID,LastModifiedByType,EmailId,NotifyOnFailure,EmailSubject,EmailBody,IsSourceCaseSensitive,IsTargetCaseSensitive,IsClientDateTime) VALUES(985,2362,N'Call EDS : MOF And DSCR Checking',76,94,0,5,1,1,30,1,2,0,N'',N'MPI_JOB_MOF_DSCR_CHECKING',0,1,'2024-03-27 05:28:20',5030,'2024-10-07 09:40:54',N'',N'MPI_BRE_PROCESS_LT',246,N'Microsoft.Data.SqlClient',N'Microsoft.Data.SqlClient',0,N'',3,0,N'','c5cf44ec-e020-484a-ba65-ab4412b21b0a',0,N'',0,Null,N'',0,0,Null)
INSERT INTO [dbo].[CIS_Mapping_Block] (OwnerID,TaskID,BlockNumber,Type,Expression,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,LastModifiedByType) VALUES(985,320,1,1,N'<parameters><inputparameters><parameters><parameter name="ItemTypeID" paramtype="Integer" value="!!ItemTypeID!!" displayvalue="!!ItemTypeID!!" valuetype="1" trackchange="0"></parameter><parameter name="ItemID" paramtype="Integer" value="!!ItemID!!" displayvalue="!!ItemID!!" valuetype="1" trackchange="0"></parameter><parameter name="ip_Flag_Blacklist" paramtype="String" value="!!ip_Flag_Blacklist!!" displayvalue="!!ip_Flag_Blacklist!!" valuetype="1" trackchange="0"></parameter></parameters></inputparameters><outputparameters></outputparameters><mappingBlocks><mappingBlock><blockName></blockName><mappingConditions></mappingConditions><mappingFields><mappingField targetField="IsSuccess" targetType="System.String" sourceExpression="F232" sourceType="" sourceValue="Is Success"></mappingField><mappingField targetField="ErrorCode" targetType="System.String" sourceExpression="F233" sourceType="" sourceValue="Error Code"></mappingField><mappingField targetField="ErrorMessage" targetType="System.String" sourceExpression="F234" sourceType="" sourceValue="Error Message"></mappingField><mappingField targetField="uniqueID" targetType="System.Int32" sourceExpression="F310" sourceType="" sourceValue="uniqueID"></mappingField><mappingField targetField="itemTypeID" targetType="System.Int32" sourceExpression="F311" sourceType="" sourceValue="itemTypeID"></mappingField><mappingField targetField="itemID" targetType="System.Int32" sourceExpression="F312" sourceType="" sourceValue="itemID"></mappingField><mappingField targetField="Deviation_Msg" targetType="System.String" sourceExpression="F235" sourceType="" sourceValue="Deviation Message"></mappingField><mappingField targetField="PDA_level" targetType="System.String" sourceExpression="F236" sourceType="" sourceValue="PDA Level"></mappingField><mappingField targetField="RuleId" targetType="System.Int32" sourceExpression="F237" sourceType="" sourceValue="RuleId"></mappingField><mappingField targetField="RuleVersion" targetType="System.String" sourceExpression="F238" sourceType="" sourceValue="RuleVersion"></mappingField></mappingFields></mappingBlock></mappingBlocks><MaxApiThreads></MaxApiThreads><resumeFlow>false</resumeFlow><fireAndForget>false</fireAndForget><edsActionType>2</edsActionType></parameters>',1,'2024-02-06 18:22:34',5030,'2024-10-07 09:40:54',-1)
INSERT INTO [dbo].[CIS_Mapping_Block] (OwnerID,TaskID,BlockNumber,Type,Expression,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,LastModifiedByType) VALUES(985,321,1,1,N'<parameters><crmnextObjectID name="CustomObjectId" type="int" /><ApplyAutoResponse>false</ApplyAutoResponse><ApplyBlockedRule>false</ApplyBlockedRule><assigntoworker>false</assigntoworker><ApplyConditionalAlert>false</ApplyConditionalAlert><ServerSideValidation>false</ServerSideValidation><MaxApiThreads>1</MaxApiThreads><BatchSize>1</BatchSize><BatchSizeParamName></BatchSizeParamName><BatchIndexParamName></BatchIndexParamName><inputParameters></inputParameters><mappingBlocks><mappingBlock><blockName>Update</blockName><mappingConditions></mappingConditions><mappingFields><mappingField targetField="ItemId" targetType="System.Int32" sourceExpression="ItemId" sourceType="System.Int32" ignoreNullOrEmpty=""></mappingField><mappingField targetField="CustomObjectId" targetType="System.Int32" sourceExpression="CustomObjectId" sourceType="System.Int32" ignoreNullOrEmpty=""></mappingField><mappingField targetField="Subject" targetType="System.String" sourceExpression="Subject" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="ExceptionSubjectiveCondition" targetType="System.String" sourceExpression="ExceptionSubjectiveCondition" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="EXC_ex1_46" targetType="System.String" sourceExpression="EXC_ex1_46" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="EXC_ex1_47" targetType="System.String" sourceExpression="EXC_ex1_47" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="EXC_ex1_48" targetType="System.String" sourceExpression="EXC_ex1_48" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="EXC_ex1_49" targetType="System.String" sourceExpression="EXC_ex1_49" sourceType="System.String" ignoreNullOrEmpty=""></mappingField></mappingFields></mappingBlock></mappingBlocks><logFields><logField></logField><logField></logField><logField></logField><logField></logField></logFields></parameters>',1,'2024-02-06 18:22:34',5030,'2024-10-07 09:40:54',-1)
INSERT INTO [dbo].[CIS_Mapping_Block] (OwnerID,TaskID,BlockNumber,Type,Expression,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,LastModifiedByType) VALUES(985,322,1,1,N'<parameters><crmnextObjectID name="CustomObjectId" type="int" /><ApplyAutoResponse>false</ApplyAutoResponse><ApplyBlockedRule>false</ApplyBlockedRule><assigntoworker></assigntoworker><ApplyConditionalAlert>false</ApplyConditionalAlert><ServerSideValidation>false</ServerSideValidation><MaxApiThreads>1</MaxApiThreads><BatchSize>1</BatchSize><BatchSizeParamName></BatchSizeParamName><BatchIndexParamName></BatchIndexParamName><inputParameters></inputParameters><mappingBlocks><mappingBlock><blockName>Insert</blockName><mappingConditions></mappingConditions><mappingFields><mappingField targetField="ItemId" targetType="System.Int32" sourceExpression="ItemId" sourceType="System.Int32" ignoreNullOrEmpty=""></mappingField><mappingField targetField="Subject" targetType="System.String" sourceExpression="Subject" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="RelatedToTypeId" targetType="System.Int32" sourceExpression="RelatedToTypeId" sourceType="System.Int32" ignoreNullOrEmpty=""></mappingField><mappingField targetField="RelatedToId" targetType="System.String" sourceExpression="RelatedToId" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="EXC_ex1_46" targetType="System.String" sourceExpression="EXC_ex1_46" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="EXC_ex1_47" targetType="System.String" sourceExpression="EXC_ex1_47" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="ExceptionSubjectiveCondition" targetType="System.String" sourceExpression="ExceptionSubjectiveCondition" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="EXC_ex1_48" targetType="System.String" sourceExpression="EXC_ex1_48" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="EXC_ex1_49" targetType="System.String" sourceExpression="EXC_ex1_49" sourceType="System.String" ignoreNullOrEmpty=""></mappingField><mappingField targetField="LayoutID" targetType="System.Int32" sourceExpression="LAYOUTID" sourceType="System.Int32" ignoreNullOrEmpty=""></mappingField><mappingField targetField="ProcessID" targetType="System.Int32" sourceExpression="PROCESSID" sourceType="System.Int32" ignoreNullOrEmpty=""></mappingField><mappingField targetField="ExceptionTypeID" targetType="System.Int32" sourceExpression="ExceptionTypeID" sourceType="System.Int32" ignoreNullOrEmpty=""></mappingField><mappingField targetField="Exc_ex1_53" targetType="System.Int32" sourceExpression="Exc_ex1_53" sourceType="System.Int32" ignoreNullOrEmpty=""></mappingField></mappingFields></mappingBlock></mappingBlocks><logFields><logField></logField><logField></logField><logField></logField><logField></logField></logFields></parameters>',1,'2024-02-06 18:22:34',5030,'2024-10-07 09:40:54',-1)
INSERT INTO [dbo].[CIS_Mapping_Block] (OwnerID,TaskID,BlockNumber,Type,Expression,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,LastModifiedByType) VALUES(985,323,1,1,N'<parameters><isasynchcall>false</isasynchcall><hasoutputprams>false</hasoutputprams><MaxApiThreads>1</MaxApiThreads><inputParameters></inputParameters><tgtInputParams></tgtInputParams><SRCBatchSize></SRCBatchSize><SRCBatchSizeParamName></SRCBatchSizeParamName><SRCBatchIndexParamName></SRCBatchIndexParamName></parameters>',1,'2024-02-06 18:22:34',5030,'2024-10-07 09:40:54',-1)
INSERT INTO [dbo].[CIS_Mapping_Block] (OwnerID,TaskID,BlockNumber,Type,Expression,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,LastModifiedByType) VALUES(985,363,1,1,N'<parameters><isasynchcall>false</isasynchcall><hasoutputprams>false</hasoutputprams><MaxApiThreads>1</MaxApiThreads><inputParameters></inputParameters><tgtInputParams></tgtInputParams><SRCBatchSize></SRCBatchSize><SRCBatchSizeParamName></SRCBatchSizeParamName><SRCBatchIndexParamName></SRCBatchIndexParamName></parameters>',4581,'2024-05-16 06:50:47',5030,'2024-10-07 09:40:54',-1)
INSERT INTO [dbo].[CIS_Mapping_Block] (OwnerID,TaskID,BlockNumber,Type,Expression,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,LastModifiedByType) VALUES(985,364,1,1,N'<parameters><inputparameters><parameters><parameter name="ItemTypeID" paramtype="Integer" value="!!ItemTypeID!!" displayvalue="!!ItemTypeID!!" valuetype="1" trackchange="0"></parameter><parameter name="ItemID" paramtype="Integer" value="!!ItemID!!" displayvalue="!!ItemID!!" valuetype="1" trackchange="0"></parameter><parameter name="ip_ascore_dec" paramtype="String" value="!!ip_ascore_dec!!" displayvalue="!!ip_ascore_dec!!" valuetype="0" trackchange="0"></parameter><parameter name="ip_bscore_dec" paramtype="String" value="!!ip_bscore_dec!!" displayvalue="!!ip_bscore_dec!!" valuetype="0" trackchange="0"></parameter></parameters></inputparameters><outputparameters></outputparameters><mappingBlocks><mappingBlock><blockName></blockName><mappingConditions></mappingConditions><mappingFields><mappingField targetField="IsSuccess" targetType="System.String" sourceExpression="F274" sourceType="" sourceValue="Is Success"></mappingField><mappingField targetField="ErrorCode" targetType="System.String" sourceExpression="F275" sourceType="" sourceValue="Error Code"></mappingField><mappingField targetField="ErrorMessage" targetType="System.String" sourceExpression="F276" sourceType="" sourceValue="Error Message"></mappingField><mappingField targetField="uniqueID" targetType="System.Int32" sourceExpression="F334" sourceType="" sourceValue="uniqueID"></mappingField><mappingField targetField="itemTypeID" targetType="System.Int32" sourceExpression="F335" sourceType="" sourceValue="itemTypeID"></mappingField><mappingField targetField="itemID" targetType="System.Int32" sourceExpression="F336" sourceType="" sourceValue="itemID"></mappingField><mappingField targetField="Deviation_Msg" targetType="System.String" sourceExpression="F277" sourceType="" sourceValue="Deviation Message"></mappingField><mappingField targetField="PDA_level" targetType="System.String" sourceExpression="F278" sourceType="" sourceValue="PDA Level"></mappingField><mappingField targetField="RuleId" targetType="System.Int32" sourceExpression="F279" sourceType="" sourceValue="RuleId"></mappingField><mappingField targetField="RuleVersion" targetType="System.String" sourceExpression="F280" sourceType="" sourceValue="RuleVersion"></mappingField></mappingFields></mappingBlock></mappingBlocks><MaxApiThreads></MaxApiThreads><resumeFlow>false</resumeFlow><fireAndForget>false</fireAndForget><edsActionType>2</edsActionType></parameters>',4581,'2024-05-16 06:50:47',5030,'2024-10-07 09:40:54',-1)
INSERT INTO [dbo].[CIS_Mapping_Block] (OwnerID,TaskID,BlockNumber,Type,Expression,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,LastModifiedByType) VALUES(985,367,1,1,N'<parameters><isasynchcall>false</isasynchcall><hasoutputprams>false</hasoutputprams><MaxApiThreads>1000</MaxApiThreads><inputParameters></inputParameters><tgtInputParams></tgtInputParams><SRCBatchSize></SRCBatchSize><SRCBatchSizeParamName></SRCBatchSizeParamName><SRCBatchIndexParamName></SRCBatchIndexParamName></parameters>',4601,'2024-10-03 08:52:56',5030,'2024-10-07 09:40:54',-1)
INSERT INTO [dbo].[CIS_Mapping_Block] (OwnerID,TaskID,BlockNumber,Type,Expression,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,LastModifiedByType) VALUES(985,369,1,1,N'<parameters><crmnextObjectID name="CustomObjectId" type="int" /><ApplyAutoResponse>false</ApplyAutoResponse><ApplyBlockedRule>false</ApplyBlockedRule><assigntoworker></assigntoworker><ApplyConditionalAlert>true</ApplyConditionalAlert><ServerSideValidation>false</ServerSideValidation><MaxApiThreads>1</MaxApiThreads><BatchSize>1000</BatchSize><BatchSizeParamName></BatchSizeParamName><BatchIndexParamName></BatchIndexParamName><inputParameters></inputParameters><mappingBlocks><mappingBlock><blockName>UPDATE FA STATUS</blockName><mappingConditions /><mappingFields><mappingField targetField="CustomObjectId" targetType="System.Int32" sourceExpression="CustomObjectId" sourceType="System.Int32" ignoreNullOrEmpty="" /><mappingField targetField="StatusCodeId" targetType="System.Int32" sourceExpression="StatusCodeId" sourceType="System.Int32" ignoreNullOrEmpty="" /></mappingFields></mappingBlock></mappingBlocks><logFields><logField>CustomObjectId</logField><logField></logField><logField></logField><logField></logField></logFields></parameters>',5030,'2024-10-04 11:30:52',5030,'2024-10-07 09:40:54',-1)
INSERT INTO [dbo].[CIS_Mapping_Block] (OwnerID,TaskID,BlockNumber,Type,Expression,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,LastModifiedByType) VALUES(985,2360,1,1,N'<parameters><inputparameters><parameters><parameter name="ITEMID" paramtype="Integer" value="!!ITEMID!!" displayvalue="!!ITEMID!!" valuetype="1" trackchange="0"></parameter><parameter name="ITEMTYPEID" paramtype="Integer" value="!!ITEMTYPEID!!" displayvalue="!!ITEMTYPEID!!" valuetype="1" trackchange="0"></parameter><parameter name="RULEID" paramtype="Integer" value="!!RULEID!!" displayvalue="!!RULEID!!" valuetype="1" trackchange="0"></parameter><parameter name="RULESUBID" paramtype="Integer" value="!!RULESUBID!!" displayvalue="!!RULESUBID!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_CONTRIBUTING_TAG" paramtype="String" value="!!IP_CONTRIBUTING_TAG!!" displayvalue="!!IP_CONTRIBUTING_TAG!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_CB_RELATIONSHIP" paramtype="String" value="!!IP_CB_RELATIONSHIP!!" displayvalue="!!IP_CB_RELATIONSHIP!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_NFIS_AMOUNT" paramtype="Decimal" value="!!IP_NFIS_AMOUNT!!" displayvalue="!!IP_NFIS_AMOUNT!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_NFIS_NATURE" paramtype="String" value="!!IP_NFIS_NATURE!!" displayvalue="!!IP_NFIS_NATURE!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_NFIS_MOS_REPORT" paramtype="Integer" value="!!IP_NFIS_MOS_REPORT!!" displayvalue="!!IP_NFIS_MOS_REPORT!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_TU_GRADE" paramtype="String" value="!!IP_TU_GRADE!!" displayvalue="!!IP_TU_GRADE!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_OVERALL_HANDLING" paramtype="String" value="!!IP_OVERALL_HANDLING!!" displayvalue="!!IP_OVERALL_HANDLING!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_ADB_6MO_INT" paramtype="Decimal" value="!!IP_ADB_6MO_INT!!" displayvalue="!!IP_ADB_6MO_INT!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_ADB_6MO_STR" paramtype="Integer" value="!!IP_ADB_6MO_STR!!" displayvalue="!!IP_ADB_6MO_STR!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_FLAG_COFP" paramtype="String" value="!!IP_FLAG_COFP!!" displayvalue="!!IP_FLAG_COFP!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_NMI" paramtype="Decimal" value="!!IP_NMI!!" displayvalue="!!IP_NMI!!" valuetype="1" trackchange="0"></parameter></parameters></inputparameters><outputparameters></outputparameters><mappingBlocks><mappingBlock><blockName></blockName><mappingConditions></mappingConditions><mappingFields><mappingField targetField="IsSuccess" targetType="System.String" sourceExpression="F2237" sourceType="" sourceValue="IsSuccess"></mappingField><mappingField targetField="ErrorCode" targetType="System.String" sourceExpression="F2238" sourceType="" sourceValue="ErrorCode"></mappingField><mappingField targetField="ErrorMessage" targetType="System.String" sourceExpression="F2239" sourceType="" sourceValue="ErrorMessage"></mappingField><mappingField targetField="uniqueID" targetType="System.Int32" sourceExpression="F2240" sourceType="" sourceValue="uniqueID"></mappingField><mappingField targetField="itemTypeID" targetType="System.Int32" sourceExpression="F2241" sourceType="" sourceValue="itemTypeID"></mappingField><mappingField targetField="itemID" targetType="System.Int32" sourceExpression="F2242" sourceType="" sourceValue="itemID"></mappingField><mappingField targetField="Deviation_Msg" targetType="System.String" sourceExpression="F2135" sourceType="" sourceValue="Deviation_Msg"></mappingField><mappingField targetField="PDA_level" targetType="System.String" sourceExpression="F2134" sourceType="" sourceValue="PDA_level"></mappingField><mappingField targetField="RuleId" targetType="System.Int32" sourceExpression="F2243" sourceType="" sourceValue="RuleId"></mappingField><mappingField targetField="RuleVersion" targetType="System.String" sourceExpression="F2244" sourceType="" sourceValue="RuleVersion"></mappingField><mappingField targetField="RuleSubId" targetType="System.Int32" sourceExpression="F2245" sourceType="" sourceValue="RuleSubId"></mappingField><mappingField targetField="DeviationCreated" targetType="System.String" sourceExpression="F2246" sourceType="" sourceValue="DeviationCreated"></mappingField><mappingField targetField="DeviationCreatedON" targetType="System.DateTime" sourceExpression="F2247" sourceType="" sourceValue="DeviationCreatedON"></mappingField></mappingFields></mappingBlock></mappingBlocks><MaxApiThreads></MaxApiThreads><resumeFlow>false</resumeFlow><fireAndForget>false</fireAndForget><edsActionType>2</edsActionType></parameters>',1,'2024-03-27 03:13:49',5030,'2024-10-07 09:40:54',-1)
INSERT INTO [dbo].[CIS_Mapping_Block] (OwnerID,TaskID,BlockNumber,Type,Expression,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,LastModifiedByType) VALUES(985,2361,1,1,N'<parameters><inputparameters><parameters><parameter name="ITEMID" paramtype="Integer" value="!!ITEMID!!" displayvalue="!!ITEMID!!" valuetype="1" trackchange="0"></parameter><parameter name="ITEMTYPEID" paramtype="Integer" value="!!ITEMTYPEID!!" displayvalue="!!ITEMTYPEID!!" valuetype="1" trackchange="0"></parameter><parameter name="RULEID" paramtype="Integer" value="!!RULEID!!" displayvalue="!!RULEID!!" valuetype="1" trackchange="0"></parameter><parameter name="RULESUBID" paramtype="Integer" value="!!RULESUBID!!" displayvalue="!!RULESUBID!!" valuetype="1" trackchange="0"></parameter><parameter name="USERID" paramtype="Integer" value="!!USERID!!" displayvalue="!!USERID!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_CONTRIBUTING_TAG_VALUE" paramtype="String" value="!!IP_CONTRIBUTING_TAG_VALUE!!" displayvalue="!!IP_CONTRIBUTING_TAG_VALUE!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_CB_RELATIONSHIP" paramtype="String" value="!!IP_CB_RELATIONSHIP!!" displayvalue="!!IP_CB_RELATIONSHIP!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_CMAP_NATURE" paramtype="String" value="!!IP_CMAP_NATURE!!" displayvalue="!!IP_CMAP_NATURE!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_CMAP_MOS_REPORT_VALUE" paramtype="String" value="!!IP_CMAP_MOS_REPORT_VALUE!!" displayvalue="!!IP_CMAP_MOS_REPORT_VALUE!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_COURT_CASE_TYPE" paramtype="String" value="!!IP_COURT_CASE_TYPE!!" displayvalue="!!IP_COURT_CASE_TYPE!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_CMAP_AMT" paramtype="Decimal" value="!!IP_CMAP_AMT!!" displayvalue="!!IP_CMAP_AMT!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_TU_GRADE" paramtype="String" value="!!IP_TU_GRADE!!" displayvalue="!!IP_TU_GRADE!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_OVERALL_HANDLING" paramtype="String" value="!!IP_OVERALL_HANDLING!!" displayvalue="!!IP_OVERALL_HANDLING!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_FLAG_COFP" paramtype="String" value="!!IP_FLAG_COFP!!" displayvalue="!!IP_FLAG_COFP!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_ADB_6MO_INT" paramtype="Decimal" value="!!IP_ADB_6MO_INT!!" displayvalue="!!IP_ADB_6MO_INT!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_ADB_6MO_STR" paramtype="String" value="!!IP_ADB_6MO_STR!!" displayvalue="!!IP_ADB_6MO_STR!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_NMI" paramtype="Decimal" value="!!IP_NMI!!" displayvalue="!!IP_NMI!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_CORPORATE" paramtype="String" value="!!IP_CORPORATE!!" displayvalue="!!IP_CORPORATE!!" valuetype="1" trackchange="0"></parameter></parameters></inputparameters><outputparameters></outputparameters><mappingBlocks><mappingBlock><blockName></blockName><mappingConditions></mappingConditions><mappingFields><mappingField targetField="IsSuccess" targetType="System.String" sourceExpression="F2171" sourceType="" sourceValue="IsSuccess"></mappingField><mappingField targetField="ErrorCode" targetType="System.String" sourceExpression="F2172" sourceType="" sourceValue="ErrorCode"></mappingField><mappingField targetField="ErrorMessage" targetType="System.String" sourceExpression="F2173" sourceType="" sourceValue="ErrorMessage"></mappingField><mappingField targetField="uniqueID" targetType="System.Int32" sourceExpression="F2174" sourceType="" sourceValue="uniqueID"></mappingField><mappingField targetField="itemTypeID" targetType="System.Int32" sourceExpression="F2175" sourceType="" sourceValue="itemTypeID"></mappingField><mappingField targetField="itemID" targetType="System.Int32" sourceExpression="F2176" sourceType="" sourceValue="itemID"></mappingField><mappingField targetField="Deviation_Msg" targetType="System.String" sourceExpression="F1139" sourceType="" sourceValue="Deviation_Msg"></mappingField><mappingField targetField="PDA_level" targetType="System.String" sourceExpression="F1138" sourceType="" sourceValue="PDA_level"></mappingField><mappingField targetField="RuleId" targetType="System.Int32" sourceExpression="F2177" sourceType="" sourceValue="RuleId"></mappingField><mappingField targetField="RuleVersion" targetType="System.String" sourceExpression="F2178" sourceType="" sourceValue="RuleVersion"></mappingField><mappingField targetField="RuleSubId" targetType="System.Int32" sourceExpression="F2179" sourceType="" sourceValue="RuleSubId"></mappingField><mappingField targetField="DeviationCreated" targetType="System.String" sourceExpression="F2180" sourceType="" sourceValue="DeviationCreated"></mappingField><mappingField targetField="DeviationCreatedON" targetType="System.DateTime" sourceExpression="F2181" sourceType="" sourceValue="DeviationCreatedON"></mappingField></mappingFields></mappingBlock></mappingBlocks><MaxApiThreads></MaxApiThreads><resumeFlow>false</resumeFlow><fireAndForget>false</fireAndForget><edsActionType>2</edsActionType></parameters>',1,'2024-03-27 03:33:59',5030,'2024-10-07 09:40:54',-1)
INSERT INTO [dbo].[CIS_Mapping_Block] (OwnerID,TaskID,BlockNumber,Type,Expression,CreatedBy,CreatedOn,LastModifiedBy,LastModifiedOn,LastModifiedByType) VALUES(985,2362,1,1,N'<parameters><inputparameters><parameters><parameter name="ITEMID" paramtype="Integer" value="!!ITEMID!!" displayvalue="!!ITEMID!!" valuetype="1" trackchange="0"></parameter><parameter name="ITEMTYPEID" paramtype="Integer" value="!!ITEMTYPEID!!" displayvalue="!!ITEMTYPEID!!" valuetype="1" trackchange="0"></parameter><parameter name="RULEID" paramtype="Integer" value="!!RULEID!!" displayvalue="!!RULEID!!" valuetype="1" trackchange="0"></parameter><parameter name="RULESUBID" paramtype="Integer" value="!!RULESUBID!!" displayvalue="!!RULESUBID!!" valuetype="1" trackchange="0"></parameter><parameter name="USERID" paramtype="Integer" value="!!USERID!!" displayvalue="!!USERID!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_MOF" paramtype="Decimal" value="!!IP_MOF!!" displayvalue="!!IP_MOF!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_BORROWER_TAG" paramtype="String" value="!!IP_BORROWER_TAG!!" displayvalue="!!IP_BORROWER_TAG!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_LOAN_TYPE" paramtype="String" value="!!IP_LOAN_TYPE!!" displayvalue="!!IP_LOAN_TYPE!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_CONDITION" paramtype="String" value="!!IP_CONDITION!!" displayvalue="!!IP_CONDITION!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_OVERALL_HANDLING" paramtype="String" value="!!IP_OVERALL_HANDLING!!" displayvalue="!!IP_OVERALL_HANDLING!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_RBP_FLAG" paramtype="String" value="!!IP_RBP_FLAG!!" displayvalue="!!IP_RBP_FLAG!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_DSCR" paramtype="Decimal" value="!!IP_DSCR!!" displayvalue="!!IP_DSCR!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_SEGMENTATION" paramtype="String" value="!!IP_SEGMENTATION!!" displayvalue="!!IP_SEGMENTATION!!" valuetype="1" trackchange="0"></parameter><parameter name="DEP_STATUS" paramtype="String" value="!!DEP_STATUS!!" displayvalue="!!DEP_STATUS!!" valuetype="1" trackchange="0"></parameter><parameter name="DEP_MOB" paramtype="Decimal" value="!!DEP_MOB!!" displayvalue="!!DEP_MOB!!" valuetype="1" trackchange="0"></parameter><parameter name="DEP_ADB" paramtype="Decimal" value="!!DEP_ADB!!" displayvalue="!!DEP_ADB!!" valuetype="1" trackchange="0"></parameter><parameter name="IP_AUTO_RBP" paramtype="String" value="!!IP_AUTO_RBP!!" displayvalue="!!IP_AUTO_RBP!!" valuetype="1" trackchange="0"></parameter></parameters></inputparameters><outputparameters></outputparameters><mappingBlocks><mappingBlock><blockName></blockName><mappingConditions></mappingConditions><mappingFields><mappingField targetField="IsSuccess" targetType="System.String" sourceExpression="F2270" sourceType="" sourceValue="IsSuccess"></mappingField><mappingField targetField="ErrorCode" targetType="System.String" sourceExpression="F2271" sourceType="" sourceValue="ErrorCode"></mappingField><mappingField targetField="ErrorMessage" targetType="System.String" sourceExpression="F2272" sourceType="" sourceValue="ErrorMessage"></mappingField><mappingField targetField="uniqueID" targetType="System.Int32" sourceExpression="F2273" sourceType="" sourceValue="uniqueID"></mappingField><mappingField targetField="itemTypeID" targetType="System.Int32" sourceExpression="F2274" sourceType="" sourceValue="itemTypeID"></mappingField><mappingField targetField="itemID" targetType="System.Int32" sourceExpression="F2275" sourceType="" sourceValue="itemID"></mappingField><mappingField targetField="Deviation_Msg" targetType="System.String" sourceExpression="F2143" sourceType="" sourceValue="Deviation_Msg"></mappingField><mappingField targetField="PDA_level" targetType="System.String" sourceExpression="F2142" sourceType="" sourceValue="PDA_level"></mappingField><mappingField targetField="RuleId" targetType="System.Int32" sourceExpression="F2276" sourceType="" sourceValue="RuleId"></mappingField><mappingField targetField="RuleVersion" targetType="System.String" sourceExpression="F2277" sourceType="" sourceValue="RuleVersion"></mappingField><mappingField targetField="RuleSubId" targetType="System.Int32" sourceExpression="F2278" sourceType="" sourceValue="RuleSubId"></mappingField><mappingField targetField="DeviationCreated" targetType="System.String" sourceExpression="F2279" sourceType="" sourceValue="DeviationCreated"></mappingField><mappingField targetField="DeviationCreatedON" targetType="System.DateTime" sourceExpression="F2280" sourceType="" sourceValue="DeviationCreatedON"></mappingField></mappingFields></mappingBlock></mappingBlocks><MaxApiThreads></MaxApiThreads><resumeFlow>false</resumeFlow><fireAndForget>false</fireAndForget><edsActionType>2</edsActionType></parameters>',1,'2024-03-27 05:28:20',5030,'2024-10-07 09:40:54',-1)


-----------SP
CREATE OR ALTER PROCEDURE [dbo].[MPI_UPDATE_FA_STATUSCODE] 
@OWNERID INT
AS
/*      
CREATED BY : ARYAN SHEKHAR                  
CREATED ON : 10-04-2024                  
DESCRIPTION: CHECK AND SELECT FA STATUS IF ALL APPROVAL RECORDS ARE APPROVED                  
EXEC MPI_UPDATE_FA_STATUSCODE 985;         
*/ 
BEGIN
SELECT 
    FA.CustomObjectId AS CustomObjectId,
    100024 AS StatusCodeId  -- Hardcoded value for StatusCodeId
FROM 
    FinancialApplication FA
WHERE 
    FA.OwnerId = 985 AND 
	FA.StatusCodeId= 100102  AND
(SELECT(SELECT SUM( CASE WHEN  StatusCodeId != 5028 THEN 1 ELSE 0 END) AS Records
From Approval A
	where A.OwnerId=985 AND A.RelatedToTypeId=100286
	AND A.RelatedToId= 103965 
	GROUP BY A.RelatedToId)) = 0 


	(
        SELECT T.CustomObjectId
        FROM (
            -- Fetch all FA records and Approval Statuses into a temporary set
            SELECT 
                FA.CustomObjectId,
                A.StatusCodeId AS ApprovalStatusCodeId
            FROM 
                FinancialApplication FA
            INNER JOIN 
                Approval A 
                ON A.OwnerId = FA.OwnerId 
                AND A.RelatedToId = FA.CustomObjectId
            WHERE 
                FA.OwnerId = @OWNERID
        ) T
        GROUP BY T.CustomObjectId
        HAVING COUNT(T.ApprovalStatusCodeId) > 0
           AND COUNT(CASE WHEN T.ApprovalStatusCodeId <> 5028 THEN 1 END) = 0
    );


END;

----------------------------

CREATE OR ALTER PROCEDURE [DBO].[MPI_UPDATE_MAX_PDA_FA](@FAID INT)                            
AS                            
/*====================================================================                             
 DESCRIPTION   : - TO UPDATE THE MAX PDA LEVEL ON FINANCIAL APPLICATION                           
 CREATED ON    : - 03-10-2024 | CREATED BY : - ALI ASGAR BAJI                                     
 EXEC [MPI_UPDATE_MAX_PDA_FA] 103972                   
=======================================================================*/                            
BEGIN                            
   DECLARE @HLVL AS NVARCHAR(5)='',@ELVL AS NVARCHAR(5)='';                                          
   DECLARE @COUNT INT,@DISTINCT INT;         
   DECLARE @APPID INT;      
         
   SELECT A.APPLICATIONID AS APPID,                        
    A.RELATEDTOID  AS 'FINANCIALAPPLICATIONID',                            
    A1.APL_EX5_36  AS 'FLAG',                      
    A.STATUSCODEID  AS 'STATUSCODEID',                      
    CASE  WHEN A1.APL_EX5_36 = 'L1'  THEN 1                            
          WHEN A1.APL_EX5_36 = 'L2'  THEN 2                            
          WHEN A1.APL_EX5_36 = 'L3'  THEN 3                            
          WHEN A1.APL_EX5_36 = 'L4'  THEN 4 END AS 'DEVLVL'                            
    INTO  #DEVLVL                             
   FROM APPLICATION A                             
   INNER JOIN APL_EX5 A1 ON A1.OWNERID = A.OWNERID AND A.APPLICATIONID = A1.APL_EX5_ID                            
   WHERE A.OWNERID = 985 AND A.RELATEDTOID = @FAID;                      
                   
   SELECT @COUNT = COUNT(*) FROM #DEVLVL WHERE STATUSCODEID!=100103                               
                    
                    
   SELECT @APPID = APPID FROM #DEVLVL WHERE STATUSCODEID!=100103                
   SELECT E.RELATEDTOID AS 'APPLICATIONID',                    
       E1.EXC_EX1_47 AS 'FLAG',                    
    CASE       
    WHEN E1.EXC_EX1_47 = 'L1'  THEN 1                    
    WHEN E1.EXC_EX1_47 = 'L2'  THEN 2                    
    WHEN E1.EXC_EX1_47 = 'L3'  THEN 3                    
    WHEN E1.EXC_EX1_47 = 'L4'  THEN 4                     
   END AS 'EXCDEVLVL'                    
   INTO #EXCLVL                     
   FROM EXCEPTION E                     
     INNER JOIN       
    EXC_EX1 E1 ON E.OWNERID = E1.OWNERID AND E.CUSTOMOBJECTID = E1.EXC_EX1_ID                    
   WHERE       
    E.OWNERID = 985 AND E.RELATEDTOID = @APPID AND (E.STATUSCODEID!=6490 OR E.STATUSCODEID IS NULL);                    
          
  SELECT @ELVL = 'L'+ CAST(MAX(ExcDEVLVL) AS NVARCHAR(20)) FROM #EXCLVL;                
                  
  UPDATE #DEVLVL                
    SET DEVLVL =                 
    CASE       
     WHEN @ELVL = 'L1' THEN 1                
     WHEN @ELVL = 'L2' THEN 2                
     WHEN @ELVL = 'L3' THEN 3                
     WHEN @ELVL = 'L4' THEN 4                
    END                
   WHERE APPID = @APPID                 
         
   SELECT @HLVL = 'L'+CAST(MAX(DEVLVL) AS NVARCHAR(20))  FROM #DEVLVL    
    PRINT '@HLVL = ' + CAST(@HLVL AS NVARCHAR(MAX));    
    
                
   UPDATE FIA_EX5                 
    SET FIA_EX5_66=@HLVL                 
    WHERE OWNERID = 985 AND FIA_EX5_ID=@FAID;                                                   
END

----------------------------

CREATE OR ALTER PROCEDURE [DBO].[MPI_UPDATE_MAX_PDA_FA](@FAID INT)                            
AS                            
/*====================================================================                             
 DESCRIPTION   : - TO UPDATE THE MAX PDA LEVEL ON FINANCIAL APPLICATION                           
 CREATED ON    : - 03-10-2024 | CREATED BY : - ALI ASGAR BAJI                                     
 EXEC [MPI_UPDATE_MAX_PDA_FA] 103972                   
=======================================================================*/                            
BEGIN                            
   DECLARE @HLVL AS NVARCHAR(5)='',@ELVL AS NVARCHAR(5)='';                                          
   DECLARE @COUNT INT,@DISTINCT INT;         
   DECLARE @APPID INT;      
         
   SELECT A.APPLICATIONID AS APPID,                        
    A.RELATEDTOID  AS 'FINANCIALAPPLICATIONID',                            
    A1.APL_EX5_36  AS 'FLAG',                      
    A.STATUSCODEID  AS 'STATUSCODEID',                      
    CASE  WHEN A1.APL_EX5_36 = 'L1'  THEN 1                            
          WHEN A1.APL_EX5_36 = 'L2'  THEN 2                            
          WHEN A1.APL_EX5_36 = 'L3'  THEN 3                            
          WHEN A1.APL_EX5_36 = 'L4'  THEN 4 END AS 'DEVLVL'                            
    INTO  #DEVLVL                             
   FROM APPLICATION A                             
   INNER JOIN APL_EX5 A1 ON A1.OWNERID = A.OWNERID AND A.APPLICATIONID = A1.APL_EX5_ID                            
   WHERE A.OWNERID = 985 AND A.RELATEDTOID = @FAID;                      
                   
   SELECT @COUNT = COUNT(*) FROM #DEVLVL WHERE STATUSCODEID!=100103                               
                    
                    
   SELECT @APPID = APPID FROM #DEVLVL WHERE STATUSCODEID!=100103                
   SELECT E.RELATEDTOID AS 'APPLICATIONID',                    
       E1.EXC_EX1_47 AS 'FLAG',                    
    CASE       
    WHEN E1.EXC_EX1_47 = 'L1'  THEN 1                    
    WHEN E1.EXC_EX1_47 = 'L2'  THEN 2                    
    WHEN E1.EXC_EX1_47 = 'L3'  THEN 3                    
    WHEN E1.EXC_EX1_47 = 'L4'  THEN 4                     
   END AS 'EXCDEVLVL'                    
   INTO #EXCLVL                     
   FROM EXCEPTION E                     
     INNER JOIN       
    EXC_EX1 E1 ON E.OWNERID = E1.OWNERID AND E.CUSTOMOBJECTID = E1.EXC_EX1_ID                    
   WHERE       
    E.OWNERID = 985 AND E.RELATEDTOID = @APPID AND (E.STATUSCODEID!=6490 OR E.STATUSCODEID IS NULL);                    
          
  SELECT @ELVL = 'L'+ CAST(MAX(ExcDEVLVL) AS NVARCHAR(20)) FROM #EXCLVL;                
                  
  UPDATE #DEVLVL                
    SET DEVLVL =                 
    CASE       
     WHEN @ELVL = 'L1' THEN 1                
     WHEN @ELVL = 'L2' THEN 2                
     WHEN @ELVL = 'L3' THEN 3                
     WHEN @ELVL = 'L4' THEN 4                
    END                
   WHERE APPID = @APPID                 
         
   SELECT @HLVL = 'L'+CAST(MAX(DEVLVL) AS NVARCHAR(20))  FROM #DEVLVL    
    PRINT '@HLVL = ' + CAST(@HLVL AS NVARCHAR(MAX));    
    
                
   UPDATE FIA_EX5                 
    SET FIA_EX5_66=@HLVL                 
    WHERE OWNERID = 985 AND FIA_EX5_ID=@FAID;                                                   
END 